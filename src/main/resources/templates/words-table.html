<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" >
    <title>–¢–∞–±–ª–∏—Ü–∞</title>
    <link rel="stylesheet" th:href="@{/css/styles.css}">
    <script th:src="@{/js/playSound.js}" defer></script>
</head>
<body>
  <h1 th:text="${category.name}"></h1>
  <h3 th:text="${category.description}"></h3>
  <div th:if="${#lists.isEmpty(views)}">
      <p>–°–ª–æ–≤ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç</p>
  </div>

  <div th:if="${wasDel}">
      <p>–í—ã —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–∏–ª–∏ —Å–ª–æ–≤–æ</p>
  </div>

  <div>
      <a th:href="@{/categories(language=${category.language.id})}">
      <button type="button">–í–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å–ø–∏—Å–∫—É –∫–∞—Ç–µ–≥–æ—Ä–∏–π</button>
      </a>
  </div>

  <div th:unless="${#lists.isEmpty(views)}">
    <a th:href="@{/categories/{id}/start-training(id=${category.id})}"><button>–ù–∞—á–∞—Ç—å —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫—É</button></a>
  </div>

  <div th:if="${isAdmin}">
  <a th:href="@{/categories/{id}/admin/add(id=${category.id})}">
      <button type="button">–î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ —Å–ª–æ–≤–æ</button>
  </a>
  </div>

  <table>
      <thead>
      <div th:if="${isAdmin}">
          <td>
              <p>ID</p>
          </td>
          <td>
              <p>–ö–Ω–æ–ø–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è</p>
          </td>
      </div>

      <div th:each="i : ${#numbers.sequence(0, category.countForms - 1)}">
        <td th:if="${category.formsInfo != null}">
            <p th:text="${category.formsInfo.get(i)}"></p>
        </td>
        <td th:unless="${category.formsInfo != null}">
            <p>—Å–ª–æ–≤–æ</p>
        </td>
        <td>
            <p>–ø–µ—Ä–µ–≤–æ–¥</p>
        </td>
        <td>
            <p>—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è</p>
        </td>
      </div>
        <td th:if="${isAuth}">
            –í–∞—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        </td>
      </thead>
      <tbody>
      <tr th:each="view : ${views}">
          <div th:if="${isAdmin}">
              <td th:text="${view.word.id}">
              </td>
              <td>
                  <div class="delWordButton">
                      <form th:action="@{/categories/{id}/admin/delete/{wordId}(id=${category.id},wordId=${view.word.id})}"
                            method="POST"
                            onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–ª–æ–≤–æ?')">
                          <button type="submit">–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ —Å–ª–æ–≤–æ</button>
                      </form>
                  </div>
              </td>
          </div>

          <div th:each="form, i : ${view.word.forms}">
              <td th:text="${form.content}"></td>
              <td th:text="${form.translation}"></td>
              <td th:if="${form.content == null}">
                  <button>–ù–µ—Ç —Ñ–æ—Ä–º—ã</button>
              </td>
              <td th:unless="${form.content == null}">
                  <div th:if="${form.isThereAudio}">
                      <audio th:src="@{/audio/{wordId}/{formIndex}(wordId=${view.word.id},formIndex=${i.index})}"
                             th:id="|audio-${view.word.id}-${i.index}|"
                             preload="none">
                      </audio>
                      <div class="audioButton">
                          <button th:onclick="|playAudio('audio-${view.word.id}-${i.index}')|"
                                  th:text="|üì¢${form.transcription}|">
                          </button>
                      </div>
                  </div>
                  <div th:unless="${form.isThereAudio}" class="audioButton">
                      <button th:text="|${form.transcription}|"
                              disabled="true">
                      </button>
                  </div>

              </td>
          </div>

          <div th:if="${isAuth}">
              <td style="padding: 8px;">
                  <div th:with="
                     correct=${view.countRightAnswers},
                     total=${view.countQuestions},
                     percentage=${total > 0 ? (correct * 100.0 / total) : 0}">
                      <div class="progress-container">
                          <div class="progress-background">
                              <div class="progress-fill" th:style="'width:' + ${percentage} + '%;'"></div>
                              <span class="progress-percent"
                                    th:text="${#numbers.formatDecimal(percentage, 0, 0)} + '%'">
                    </span>
                          </div>
                          <div class="progress-numbers" th:text="${correct} + '/' + ${total}"></div>
                      </div>
                  </div>
              </td>
          </div>
      </tr>
      </tbody>
  </table>
</body>
</html>